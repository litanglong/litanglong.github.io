(function(e){function t(t){for(var a,r,s=t[0],c=t[1],u=t[2],l=0,p=[];l<s.length;l++)r=s[l],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&p.push(o[r][0]),o[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);d&&d(t);while(p.length)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(a=!1)}a&&(i.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},o={app:0},i=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"01cb":function(e,t,n){},"063b":function(e,t,n){},"0817":function(e,t,n){},"0fc1":function(e,t,n){"use strict";n("a0ca")},"12ae":function(e,t,n){e.exports=n.p+"img/loading.36bf82f6.gif"},"23a2":function(e,t,n){e.exports=n.p+"img/failed.e1eefb54.png"},"4d0c":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),o=n("bc3a"),i=n.n(o),r=n("a7fe"),s=n.n(r),c=(n("942f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)}),u=[],d={name:"app"},l=d,p=(n("931a"),n("2877")),f=Object(p["a"])(l,c,u,!1,null,null,null),h=f.exports,m=n("8c4f"),g={methods:{setTitleHack:function(e){document.title=e}}},v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page no_header no_footer"},[a("div",{staticClass:"body box_vertical flex_orient_center"},[a("h5",[e._v("身份核验")]),a("img",{staticClass:"face_img",attrs:{src:n("f5f0"),alt:"",srcset:""}}),e.uploadReason?a("p",{staticClass:"reason_text"},[e._v("系统提示："+e._s(e.uploadReason))]):e._e(),a("div",{staticClass:"shooting_box"},[a("p",{staticClass:"shooting_btn"},[e._v(e._s(e.uploadReason?"重新拍摄":"开始拍摄"))]),a("input",{staticClass:"file_input",attrs:{type:"file",name:"shooting",capture:"user",accept:"image/*"},on:{change:function(t){return e.handleFileChange(t)}}})]),a("p",{staticClass:"back_btn",on:{click:e.backAction}},[e._v("退出验证")])]),e.isShowLoading?a("loading"):e._e()],1)},w=[],_=(n("6762"),n("2fdb"),n("7f7f"),n("96cf"),n("1da1")),b={testQueryStatus:function(e){return a["a"].axios.post("/commonface/common/verificationStatus",e)},uploadFaceVideo:function(e){return a["a"].axios.post("/commonface/common/upload",e)}},x=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},y=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loading"},[a("div",{staticClass:"loading_content box flex_pack_center flex_orient_center"},[a("img",{attrs:{src:n("12ae"),alt:""}})])])}],C={},k=C,S=(n("6ae6"),Object(p["a"])(k,x,y,!1,null,"19673465",null)),R=S.exports,T=n("6ca8"),L=n.n(T),M={components:{Loading:R},data:function(){return{isShowLoading:!1,query:{},uploadReason:""}},created:function(){var e=this,t=this.$route.query||{};this.query=t,this.isShowLoading=!0;var n=new FormData;n.append("msg",t.msg),n.append("sign",t.sign),n.append("appkey",t.appkey),b.testQueryStatus(n).then((function(t){if(console.log(t),e.isShowLoading=!1,t&&t.data&&"S"===t.data.retCode);else{var n=t&&t.data&&t.data.retMsg||"";e.$router.push({name:"failed",params:{reason:n}})}}),(function(){e.$router.push("failed")}))},mounted:function(){},methods:{handleFileChange:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t){var n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.target.files[0],console.log(n),!(n.size>31457280)){e.next=5;break}return this.uploadReason="请重新拍摄3~5秒的视频",e.abrupt("return");case 5:return console.log((new Date).getTime()),console.log("压缩前",n.size/1024),e.next=9,this.lrzToLimit(n,204800);case 9:a=e.sent,o=new window.File([a.file],n.name,{type:n.type}),console.log("压缩后",o.size/1024),this.uploadFaceVideo(o);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),backAction:function(){window.history.go(-1)},uploadFaceVideo:function(e){var t=this,n=new FormData;n.append("msg",this.query.msg),n.append("sign",this.query.sign),n.append("file",e),n.append("appkey",this.query.appkey),this.isShowLoading=!0,b.uploadFaceVideo(n).then((function(e){if(t.isShowLoading=!1,e&&e.data&&e.data.retCode&&["0","1"].includes(e.data.retCode)){if(t.uploadReason=e.data.retMsg,e.data.fronturl){var n="retcode="+e.data.retCode+"&retmsg="+e.data.retMsg;e.data.fronturl.includes("?")?setTimeout((function(){window.location.href=e.data.fronturl+"&"+n+"&time="+(new Date).getTime()}),300):setTimeout((function(){window.location.href=e.data.fronturl+"?"+n+"&time="+(new Date).getTime()}),300)}}else{var a=e&&e.data&&e.data.retMsg||"上传失败";t.uploadReason=a}}),(function(){t.isShowLoading=!1,t.uploadReason="上传失败"}))},lrzToLimit:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t,n){var a,o,i,r,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=n&&0!==n?n:512e3,o=1280,i="",!(t.size<=a)){e.next=9;break}r=window.URL||window.webkitURL,s=r.createObjectURL(t),i={file:t,base64:s},e.next=12;break;case 9:return e.next=11,L()(t,{quality:1});case 11:i=e.sent;case 12:c=0;case 13:if(!(c<10)){e.next=23;break}if(!(i.file.size<=a)){e.next=16;break}return e.abrupt("return",i);case 16:return e.next=18,L()(t,{width:o,quality:1});case 18:i=e.sent,o*=.75;case 20:c++,e.next=13;break;case 23:return e.abrupt("return",i);case 24:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()}},O=M,j=(n("e4e7"),Object(p["a"])(O,v,w,!1,null,"a78ce24a",null)),F=j.exports,q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page no_header no_footer"},[a("div",{staticClass:"body box_vertical flex_orient_center"},[a("img",{staticClass:"failed_img",attrs:{src:n("23a2"),alt:"",srcset:""}}),a("p",{staticClass:"desc"},[e._v(e._s(e.reason))]),a("p",{staticClass:"shooting_btn",on:{click:e.backAction}},[e._v("返回")])])])},D=[],$={components:{},data:function(){return{reason:""}},created:function(){this.reason=this.$route.params&&this.$route.params.reason||"服务开小差了"},mounted:function(){},methods:{backAction:function(){window.history.go(-2)}}},A=$,P=(n("662f"),Object(p["a"])(A,q,D,!1,null,"3efaefe4",null)),V=P.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",["model1"===e.modelShow?n("model1"):e._e(),"model2"===e.modelShow?n("model2"):e._e()],1)},z=[],B=(n("28a5"),n("57e7"),n("4917"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page no_header no_footer"},[a("div",{staticClass:"body box_vertical flex_orient_center flex_pack_right"},[a("img",{staticClass:"face_img",attrs:{src:n("7888"),alt:"",srcset:""}}),a("div",{staticClass:"bottom box_vertical flex_orient_center"},[a("h1",[e._v("录制3~4秒视频，读出以下数字")]),a("div",{staticClass:"num"},e._l(e.numberArr,(function(t,n){return a("span",{key:n},[e._v(e._s(t))])})),0),a("div",{staticClass:"shooting_box"},[a("p",{staticClass:"shooting_btn"},[e._v("记下了，开始拍摄")]),a("input",{staticClass:"file_input",attrs:{type:"file",name:"shooting",capture:"user",accept:"video/*"},on:{change:function(t){return e.handleFileChange(t)}}})]),a("p",{staticClass:"back_btn",on:{click:e.backAction}},[e._v("退出验证")])])]),e.isShowModal?a("div",{staticClass:"modal box_vertical flex_orient_center flex_pack_center"},[a("div",{staticClass:"modal_content"},[a("h1",{staticClass:"modal_title"},[e._v("视频验证失败")]),a("p",{staticClass:"modal_desc"},[e._v(e._s(e.uploadReason))]),a("div",{staticClass:"modal_btn_box box flex_orient_center flex_pack_center",on:{click:function(t){return e.sure()}}},[a("p",{staticClass:"modal_btn"},[e._v("知道了")])])])]):e._e(),e.isShowLoading?a("loading"):e._e()],1)}),N=[],U={components:{Loading:R},data:function(){return{isShowLoading:!1,isShowModal:!1,query:{},uploadReason:"",numberArr:[]}},created:function(){var e=this;this.getRandomNum();var t=this.$route.query||{};this.query=t,console.log(this.query),this.isShowLoading=!0;var n=new FormData;n.append("msg",t.msg),n.append("sign",t.sign),n.append("appkey",t.appkey),b.testQueryStatus(n).then((function(t){if(console.log(t),e.isShowLoading=!1,t&&t.data&&"S"===t.data.retCode);else{var n=t&&t.data&&t.data.retMsg||"";e.$router.push({name:"failed",params:{reason:n}})}}),(function(){e.$router.push("failed")}))},mounted:function(){},methods:{handleFileChange:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.target.files[0],console.log(n),console.log((new Date).getTime()),console.log("视频大小",n.size/1024),e.next=6,this.getVideoDuration(n);case 6:if(a=e.sent,console.log("视频时长",a),!(a<2)){e.next=12;break}return this.uploadReason="拍摄时间小于3秒，请重新拍摄3~4秒的视频",this.isShowModal=!0,e.abrupt("return");case 12:if(!(a>5)){e.next=16;break}return this.uploadReason="拍摄时间大于4秒，请重新拍摄3~4秒的视频",this.isShowModal=!0,e.abrupt("return");case 16:this.uploadFaceVideo(n);case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),backAction:function(){window.history.go(-1)},uploadFaceVideo:function(e){var t=this,n=new FormData;n.append("msg",this.query.msg),n.append("sign",this.query.sign),n.append("file",e),n.append("appkey",this.query.appkey),this.isShowLoading=!0,b.uploadFaceVideo(n).then((function(e){if(t.isShowLoading=!1,e&&e.data&&e.data.retCode&&["0","1","2"].includes(e.data.retCode)){if(t.uploadReason=e.data.retMsg,e.data.fronturl){var n="retcode="+e.data.retCode+"&retmsg="+e.data.retMsg;e.data.fronturl.includes("?")?window.location.href=e.data.fronturl+"&"+n+"&time="+(new Date).getTime():window.location.href=e.data.fronturl+"?"+n+"&time="+(new Date).getTime()}}else{var a=e&&e.data&&e.data.retMsg||"上传失败";t.uploadReason=a,t.showToast(a),t.getRandomNum()}}),(function(){t.isShowLoading=!1,t.uploadReason="上传失败",t.showToast("上传失败"),t.getRandomNum()}))},getVideoDuration:function(e){return new Promise((function(t){var n=URL.createObjectURL(e),a=new Audio(n);a.muted=!0,a.play().then((function(){return a.pause()})),a.addEventListener("loadedmetadata",(function(e){var n=a.duration;t(n)}))}))},getRandomNum:function(){this.numberArr=[];for(var e=0;e<4;e++){var t=parseInt(9*Math.random());this.numberArr.push(t)}},sure:function(){this.isShowModal=!1,this.getRandomNum()}}},H=U,I=(n("0fc1"),Object(p["a"])(H,B,N,!1,null,"8a7ed07e",null)),Q=I.exports,J=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page no_header no_footer"},[a("div",{staticClass:"body box_vertical flex_orient_center"},[a("h5",[e._v("身份核验")]),a("img",{staticClass:"face_img",attrs:{src:n("f5f0"),alt:"",srcset:""}}),e.uploadReason?a("p",{staticClass:"reason_text"},[e._v("系统提示："+e._s(e.uploadReason))]):e._e(),a("div",{staticClass:"shooting_box"},[a("p",{staticClass:"shooting_btn",on:{click:e.handleTakeBtn}},[e._v(e._s(e.uploadReason?"重新拍摄":"开始拍摄"))])]),a("p",{staticClass:"back_btn",on:{click:e.backAction}},[e._v("退出验证")])]),e.isShowLoading?a("loading"):e._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isBegin,expression:"isBegin"}],staticClass:"video_page"},[a("video",{ref:"video",staticClass:"face_video",attrs:{muted:"",autoplay:"",playsinline:""},domProps:{muted:!0}}),a("div",{staticClass:"box flex_orient_center flex_pack_center video_page_bottom"},[e.isShowTip?a("span",{staticClass:"tip"},[e._v("请正对摄像头，即将开始拍摄")]):a("span",{staticClass:"num"},[e._v(e._s(e.countDownCode))])])])],1)},W=[],G=(n("ac6a"),n("f3e2"),n("a9ee")),K=n("bea0"),X=n.n(K),Y={components:{Loading:R},data:function(){return{isShowLoading:!1,isShowModal:!1,query:{},uploadReason:"",numberArr:[],isBegin:!1,timer:null,countDownCode:3,isShowTip:!0}},created:function(){},mounted:function(){},methods:{backAction:function(){window.history.go(-1)},uploadFaceVideo:function(e){var t=this,n=new FormData;n.append("msg",this.query.msg),n.append("sign",this.query.sign),n.append("file",e),n.append("appkey",this.query.appkey),this.isShowLoading=!0,b.uploadFaceVideo(n).then((function(e){if(t.isShowLoading=!1,e&&e.data&&e.data.retCode&&["0","1","2"].includes(e.data.retCode)){if(t.uploadReason=e.data.retMsg,e.data.fronturl){var n="retcode="+e.data.retCode+"&retmsg="+e.data.retMsg;e.data.fronturl.includes("?")?window.location.href=e.data.fronturl+"&"+n+"&time="+(new Date).getTime():window.location.href=e.data.fronturl+"?"+n+"&time="+(new Date).getTime()}}else{var a=e&&e.data&&e.data.retMsg||"上传失败";t.uploadReason=a,t.showToast(a)}}),(function(){t.isShowLoading=!1,t.uploadReason="上传失败",t.showToast("上传失败")}))},sure:function(){this.isShowModal=!1},handleTakeBtn:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(){var t,n,a,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isShowTip=!0,e.prev=1,t={audio:!1,video:{facingMode:"user",height:"720",width:"1280"}},e.next=5,navigator.mediaDevices.getUserMedia(t);case 5:n=e.sent,a=this.$refs.video,a.style.width=document.width+"px",a.style.height=document.height+"px",a.oncanplay=Object(_["a"])(regeneratorRuntime.mark((function e(){var t,i,r,s,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("分辨率："+a.videoWidth+" "+a.videoHeight),o.isBegin=!0,t=new G["RecordRTCPromisesHandler"](n,{type:"video",mimeType:"video/webm;codecs=vp8"}),i=function(e){return new Promise((function(t){return setTimeout(t,e)}))},r=6;case 5:if(!(r>0)){e.next=16;break}if(3!==r){e.next=10;break}return e.next=9,t.startRecording();case 9:o.isShowTip=!1;case 10:return o.countDownCode=r,e.next=13,i(1e3);case 13:r--,e.next=5;break;case 16:return e.next=18,t.stopRecording();case 18:return e.next=20,t.getBlob();case 20:return s=e.sent,o.isBegin=!1,n.getTracks().forEach((function(e){e.stop()})),e.next=25,X()(s,3e3);case 25:c=e.sent,u=new File([c],"video.mp4",{type:"video/mp4"}),o.uploadFaceVideo(u);case 28:case"end":return e.stop()}}),e)}))),a.srcObject=n,e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](1),console.log(e.t0.message),-1!==e.t0.message.indexOf("denied")&&this.showToast("摄像头未授权");case 17:case"end":return e.stop()}}),e,this,[[1,13]])})));function t(){return e.apply(this,arguments)}return t}()}},Z=Y,ee=(n("8c65"),Object(p["a"])(Z,J,W,!1,null,"2aa57160",null)),te=ee.exports,ne={components:{Loading:R,Model1:Q,Model2:te},data:function(){return{modelShow:""}},created:function(){var e=window.navigator.userAgent.toLocaleLowerCase(),t=e.match(/&&appversion=([\d.]+)/),n=e.match(/&&appinfo=(\w+)/),a=t&&t[1],o=n&&n[1];e.indexOf("android")>-1?this.modelShow="model2":this.modelShow="model1",e.indexOf("android")>-1&&o&&a&&this.compareVersion(a,"6.14.0")<0&&(this.modelShow="model1")},methods:{compareVersion:function(e,t){e=e.split("."),t=t.split(".");var n=Math.max(e.length,t.length);while(e.length<n)e.push("0");while(t.length<n)t.push("0");for(var a=0;a<n;a++){var o=parseInt(e[a]),i=parseInt(t[a]);if(o>i)return 1;if(o<i)return-1}return 0}}},ae=ne,oe=(n("5c91"),Object(p["a"])(ae,E,z,!1,null,"bc43a45c",null)),ie=oe.exports;a["a"].use(m["a"]);var re=new m["a"]({routes:[{path:"/",redirect:"/facecom"},{path:"/facecom",name:"facecom",component:F,meta:{title:"人脸识别"}},{path:"/facecomvideo",name:"facecomvideo",component:ie,meta:{title:"人脸识别"}},{path:"/failed",name:"failed",component:V,meta:{title:"人脸识别"}}]}),se=m["a"].prototype.push;m["a"].prototype.push=function(e){return se.call(this,e).catch((function(e){return e}))},re.beforeEach((function(e,t,n){g.methods.setTitleHack(e.meta.title),n()}));var ce=re,ue={init:function(){a["a"].axios.interceptors.response.use((function(e){return e&&e.data}),(function(e){var t=e.response.status;if(t&&/4\d\d/.test(t)){switch(t){case 404:console.error("404 Not Found!");break;default:console.error("出错啦，请稍后再试")}return Promise.reject(e.response)}return 0===t||502===t||504===t?(console.error("ajax timeout error: 网络不给力，数据请求超时，请稍后再试"),Promise.reject(e.response)):Promise.reject(e.response)}))}};function de(e,t){var n=document.createElement("div"),a=1e3*e||3e3;n.innerHTML=t,n.className="toast",document.body.appendChild(n),setTimeout((function(){document.body.removeChild(n)}),a)}var le={install:function(e){e.prototype.showToast=function(t){e.prototype.toast(2,t)},e.showToast=function(t){e.toast(2,t)},e.toast=de,e.prototype.toast=de}};a["a"].use(s.a,i.a),a["a"].use(le),ue.init(),new a["a"]({router:ce,render:function(e){return e(h)}}).$mount("#app")},"5c91":function(e,t,n){"use strict";n("01cb")},"662f":function(e,t,n){"use strict";n("4d0c")},"6ad7":function(e,t,n){},"6ae6":function(e,t,n){"use strict";n("063b")},7888:function(e,t,n){e.exports=n.p+"img/facevideo.db89733b.png"},"8c65":function(e,t,n){"use strict";n("6ad7")},"931a":function(e,t,n){"use strict";n("0817")},"942f":function(e,t,n){},a0ca:function(e,t,n){},e4e7:function(e,t,n){"use strict";n("f861")},f5f0:function(e,t,n){e.exports=n.p+"img/face.5347a6ed.png"},f861:function(e,t,n){}});
//# sourceMappingURL=app.29bbb55f.js.map